const angelleyeOrder={productAddToCart:!0,lastApiResponse:null,isCheckoutPage:()=>"checkout"===angelleye_ppcp_manager.page,isProductPage:()=>"product"===angelleye_ppcp_manager.page,isCartPage:()=>"cart"===angelleye_ppcp_manager.page,isSale:()=>"capture"===angelleye_ppcp_manager.paymentaction,isOrderPayPage(){let e=new URL(window.location.href);return e.searchParams.has("pay_for_order")},isOrderCompletePage(){let e=new URL(window.location.href);return e.searchParams.has("paypal_order_id")},getSelectedPaymentMethod:()=>jQuery('input[name="payment_method"]:checked').val(),isApplePayPaymentMethodSelected:()=>"angelleye_ppcp_apple_pay"===angelleyeOrder.getSelectedPaymentMethod(),isPpcpPaymentMethodSelected:()=>"angelleye_ppcp"===angelleyeOrder.getSelectedPaymentMethod(),isCCPaymentMethodSelected:()=>"angelleye_ppcp_cc"===angelleyeOrder.getSelectedPaymentMethod(),isGooglePayPaymentMethodSelected:()=>"angelleye_ppcp_google_pay"===angelleyeOrder.getSelectedPaymentMethod(),isAngelleyePpcpPaymentMethodSelected(){let e=angelleyeOrder.getSelectedPaymentMethod();return"angelleye_ppcp"===e||"angelleye_ppcp_apple_pay"===e||"angelleye_ppcp_google_pay"===e},isAngelleyePpcpAdditionalPaymentMethodSelected(){let e=angelleyeOrder.getSelectedPaymentMethod();return"angelleye_ppcp_apple_pay"===e||"angelleye_ppcp_google_pay"===e},isAngelleyePaymentMethodSelected(){let e=angelleyeOrder.getSelectedPaymentMethod();return"paypal_express"===e||"angelleye_ppcp"===e||"angelleye_ppcp_apple_pay"===e||"angelleye_ppcp_google_pay"===e},isSavedPaymentMethodSelected(){let e=jQuery('input[name="wc-'+angelleyeOrder.getSelectedPaymentMethod()+'-payment-token"]:checked');if(e.length){let r=e.val();if(void 0!==r&&"new"!==r)return!0}return!1},isApplePayEnabled:()=>""!==angelleye_ppcp_manager.apple_sdk_url,isGooglePayEnabled:()=>""!==angelleye_ppcp_manager.google_sdk_url,getConstantValue:(e,r)=>angelleye_ppcp_manager.constants&&angelleye_ppcp_manager.constants[e]?angelleye_ppcp_manager.constants[e]:r,getCheckoutSelectorCss(){let e=".woocommerce";return angelleyeOrder.isCheckoutPage()?e="yes"===angelleye_ppcp_manager.is_pay_page?"form#order_review":"form.checkout":"add_payment_method"===angelleye_ppcp_manager.page&&(e="form#add_payment_method"),e},getWooNoticeAreaSelector(){let e=".woocommerce-notices-wrapper:first",r=angelleyeOrder.getCheckoutSelectorCss();return jQuery(r).find(e).length&&jQuery(r).find(e).is(":visible")?`${r} ${e}`:jQuery(e).length?e:angelleyeOrder.getCheckoutSelectorCss()},scrollToWooCommerceNoticesSection(){let e=jQuery(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=jQuery("form.checkout")),e.length||(e=jQuery("form#order_review")),e.length&&jQuery("html, body").animate({scrollTop:e.offset().top-100},1e3)},updateWooCheckoutFormNonce(e){angelleye_ppcp_manager.woocommerce_process_checkout=e,jQuery("#woocommerce-process-checkout-nonce").val(e)},createSmartButtonOrder:({angelleye_ppcp_button_selector:e,errorLogId:r})=>angelleyeOrder.createOrder({angelleye_ppcp_button_selector:e,errorLogId:r}).then(e=>e.orderID),createOrder({angelleye_ppcp_button_selector:e,billingDetails:r,shippingDetails:o,apiUrl:t,errorLogId:a,callback:l}){void 0===t&&(t=angelleye_ppcp_manager.create_order_url),angelleyeOrder.lastApiResponse=null;let n=angelleyeOrder.getWooFormSelector();angelleyeOrder.removeError();let c,d=angelleyeOrder.isCheckoutPage(),s=angelleyeOrder.isProductPage(),p=null,i=null;return r&&(p=jQuery("<input>",{type:"hidden",name:"billing_address_source",value:JSON.stringify(r)})),o&&(i=jQuery("<input>",{type:"hidden",name:"shipping_address_source",value:JSON.stringify(o)})),console.log("formSelector",e,n,jQuery(n).length),d&&["#angelleye_ppcp_checkout_top","#angelleye_ppcp_checkout_top_google_pay","#angelleye_ppcp_checkout_top_apple_pay"].indexOf(e)>-1?c="":(s&&(jQuery(n).find("input[name=angelleye_ppcp-add-to-cart]").remove(),angelleyeOrder.productAddToCart&&(jQuery("<input>",{type:"hidden",name:"angelleye_ppcp-add-to-cart",value:jQuery("[name='add-to-cart']").val()}).appendTo(n),angelleyeOrder.productAddToCart=!1)),p&&(jQuery(n).find("input[name=billing_address_source]").remove(),p.appendTo(n)),i&&(jQuery(n).find("input[name=shipping_address_source]").remove(),i.appendTo(n)),c=jQuery(n).serialize()),angelleyeJsErrorLogger.addToLog(a,{context:"api_request",url:t,method:"POST",body:c,time:new Date}),fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}).then(async function(e){if(angelleyeJsErrorLogger.addToLog(a,{context:"api_response",response:e,redirected:e.redirected,status:e.status,time:new Date}),console.log("createOrder response",{res:e,apiUrl:t,redirected:e.redirected,url:e.url,status:e.status}),!e.redirected)return angelleyeOrder.lastApiResponse=await e.clone().text(),e.json();window.location.href=e.url}).then(function(e){if("function"==typeof l){l(e);return}if(void 0===e.success)return e;{let r=e.data.messages?e.data.messages:e.data;throw"string"!=typeof r?(r=r.map(function(e){return"<li>"+e+"</li>"}).join(""),""!==localizedMessages.error_message_checkout_validation&&(r="<li>"+localizedMessages.error_message_checkout_validation+"</li>"+r)):r="<li>"+r+"</li>",r}}).then(e=>(angelleyeOrder.isCheckoutPage()&&void 0!==e.nonce&&angelleyeOrder.updateWooCheckoutFormNonce(e.nonce),e))},approveOrder({orderID:e,payerID:r,errorLogId:o}){angelleyeOrder.isCheckoutPage()?angelleyeOrder.checkoutFormCapture({payPalOrderId:e,errorLogId:o}):"yes"===angelleye_ppcp_manager.is_skip_final_review?window.location.href=angelleye_ppcp_manager.direct_capture+"&paypal_order_id="+e+"&paypal_payer_id="+r+"&from="+angelleye_ppcp_manager.page:window.location.href=angelleye_ppcp_manager.checkout_url+"&paypal_order_id="+e+(r?"&paypal_payer_id="+r:"")+"&from="+angelleye_ppcp_manager.page},shippingAddressUpdate:(e,r,o)=>angelleyeOrder.createOrder({apiUrl:angelleye_ppcp_manager.shipping_update_url,shippingDetails:e,billingDetails:r,errorLogId:o}),triggerPaymentCancelEvent(){jQuery(document.body).trigger("angelleye_paypal_oncancel")},onCancel(){angelleyeOrder.triggerPaymentCancelEvent(),angelleyeOrder.isCheckoutPage()||(angelleyeOrder.showProcessingSpinner(),angelleyeOrder.isProductPage()||window.location.reload())},prepareWooErrorMessage:e=>'<ul class="woocommerce-error">'+e+"</ul>",removeError(){jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove()},showError(e){e=angelleyeOrder.prepareWooErrorMessage(e);let r=angelleyeOrder.getWooNoticeAreaSelector();jQuery(r).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),jQuery(r).removeClass("processing").unblock(),jQuery(r).is(":visible")||jQuery(r).css("display","block"),jQuery(r).find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),angelleyeOrder.scrollToWooCommerceNoticesSection()},showProcessingSpinner(e){void 0===e&&(e=".woocommerce"),jQuery(e).length&&jQuery(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},hideProcessingSpinner(e){void 0===e&&(e=".woocommerce"),jQuery(e).length&&jQuery(e).unblock()},handleCreateOrderError(e,r){console.log("create_order_error",e,angelleyeOrder.lastApiResponse),angelleyeOrder.hideProcessingSpinner(),jQuery(document.body).trigger("angelleye_paypal_onerror");let o=e.message?e.message:e;if(o.toLowerCase().indexOf("expected an order id to be passed")>-1)0>o.toLowerCase().indexOf("required fields")&&(o=localizedMessages.create_order_error);else if(o.toLowerCase().indexOf("unexpected token")>-1){let t=jQuery("<textarea/>").text(angelleyeOrder.lastApiResponse).html();angelleyeJsErrorLogger.logJsError("InvalidJSON, Received Response: "+t,r),o="<li>"+localizedMessages.create_order_error+"</li>"}""!==o&&angelleyeOrder.showError(o),angelleyeOrder.scrollToWooCommerceNoticesSection(),angelleyeOrder.isCheckoutPage()},isHostedFieldEligible:()=>!!angelleyeOrder.isCheckoutPage()&&"yes"===angelleye_ppcp_manager.advanced_card_payments&&"undefined"!=typeof angelleye_paypal_sdk&&void 0!==angelleye_paypal_sdk.HostedFields&&!0===angelleye_paypal_sdk.HostedFields.isEligible(),showPpcpPaymentMethods(){jQuery("#angelleye_ppcp_checkout, #angelleye_ppcp_checkout_apple_pay, #angelleye_ppcp_checkout_google_pay").hide(),angelleyeOrder.isApplePayPaymentMethodSelected()?jQuery("#angelleye_ppcp_checkout_apple_pay").show():angelleyeOrder.isGooglePayPaymentMethodSelected()?jQuery("#angelleye_ppcp_checkout_google_pay").show():jQuery("#angelleye_ppcp_checkout").show()},hidePpcpPaymentMethods(){jQuery("#angelleye_ppcp_checkout, #angelleye_ppcp_checkout_apple_pay, #angelleye_ppcp_checkout_google_pay").hide()},hideShowPlaceOrderButton(){let e=angelleyeOrder.getSelectedPaymentMethod();console.log("hideShowPlaceOrderButton",e);let r=angelleyeOrder.isAngelleyePpcpPaymentMethodSelected();!0===r&&jQuery(".wcf-pre-checkout-offer-action").val(""),!1===angelleyeOrder.isHostedFieldEligible()&&jQuery(".payment_method_angelleye_ppcp_cc").hide(),!0===r&&"no"===angelleye_ppcp_manager.is_checkout_disable_smart_button||angelleyeOrder.isAngelleyePpcpAdditionalPaymentMethodSelected()?(showHidePlaceOrderBtn(),angelleyeOrder.showPpcpPaymentMethods()):(angelleyeOrder.hidePpcpPaymentMethods(),showHidePlaceOrderBtn())},createHiddenInputField({fieldId:e,fieldName:r,fieldValue:o,fieldType:t,appendToSelector:a}){jQuery("#"+e).length>0&&jQuery("#"+e).remove(),jQuery("<input>",{type:void 0===t?"hidden":t,id:e,name:r,value:o}).appendTo(a)},getWooFormSelector(){let e="";return angelleyeOrder.isProductPage()?e="form.cart":angelleyeOrder.isCartPage()?e="form.woocommerce-cart-form":angelleyeOrder.isCheckoutPage()&&(e=angelleyeOrder.getCheckoutSelectorCss()),e},setPaymentMethodSelector(e){let r=angelleyeOrder.getWooFormSelector();angelleyeOrder.createHiddenInputField({fieldId:"angelleye_ppcp_payment_method_title",fieldName:"angelleye_ppcp_payment_method_title",fieldValue:e,appendToSelector:r})},renderSmartButton(){console.log("render smart buttons"),jQuery.each(angelleye_ppcp_manager.button_selector,function(e,r){if(!jQuery(r).length||jQuery(r).children().length||"undefined"==typeof angelleye_paypal_sdk)return;let o={layout:angelleye_ppcp_manager.style_layout,color:angelleye_ppcp_manager.style_color,shape:angelleye_ppcp_manager.style_shape,label:angelleye_ppcp_manager.style_label};""!==angelleye_ppcp_manager.style_height&&(o.height=parseInt(angelleye_ppcp_manager.style_height)),"vertical"!==angelleye_ppcp_manager.style_layout&&(o.tagline="yes"===angelleye_ppcp_manager.style_tagline);let t=null;angelleye_paypal_sdk.Buttons({style:o,createOrder:function(e,o){return t=angelleyeJsErrorLogger.generateErrorId(),angelleyeJsErrorLogger.addToLog(t,"PayPal Smart Button Payment Started"),angelleyeOrder.createSmartButtonOrder({angelleye_ppcp_button_selector:r,errorLogId:t})},onApprove:function(e,r){angelleyeOrder.showProcessingSpinner(),angelleyeOrder.approveOrder({...e,errorLogId:t})},onCancel:function(e,r){angelleyeOrder.hideProcessingSpinner(),angelleyeOrder.onCancel()},onClick:function(e,r){angelleyeOrder.setPaymentMethodSelector(e.fundingSource)},onError:function(e){angelleyeOrder.handleCreateOrderError(e,t)}}).render(r)}),angelleyeOrder.isApplePayEnabled()&&jQuery.each(angelleye_ppcp_manager.apple_pay_btn_selector,function(e,r){new ApplePayCheckoutButton().render(r)}),angelleyeOrder.isGooglePayEnabled()&&jQuery.each(angelleye_ppcp_manager.google_pay_btn_selector,function(e,r){new GooglePayCheckoutButton().render(r)})},checkoutFormCapture({checkoutSelector:e,payPalOrderId:r,errorLogId:o}){void 0===e&&(e=angelleyeOrder.getCheckoutSelectorCss());let t=angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+r+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout+"&is_pay_page="+angelleye_ppcp_manager.is_pay_page,a;angelleyeOrder.isCheckoutPage()&&(a=jQuery(e).serialize()),void 0!==window.can_update_checkout&&(jQuery(e).on("checkout_place_order_"+angelleyeOrder.getSelectedPaymentMethod(),function(){return!1}),jQuery(e).submit()),fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then(function(e){return e.json()}).then(function(e){window.location.href=e.data.redirect}).catch(r=>{console.log("capture error",r),jQuery(e).removeClass("processing paypal_cc_submiting HostedFields createOrder"),angelleyeOrder.handleCreateOrderError(r,o),angelleyeOrder.hideProcessingSpinner("#customer_details, .woocommerce-checkout-review-order")})},renderHostedButtons(){let e=angelleyeOrder.getCheckoutSelectorCss();if(jQuery(e).is(".HostedFields"))return!1;if("undefined"==typeof angelleye_paypal_sdk)return;let r=e;jQuery("#customer_details").length&&jQuery(".woocommerce-checkout-review-order").length&&(r="#customer_details, .woocommerce-checkout-review-order"),jQuery(e).addClass("HostedFields");let o=null;angelleye_paypal_sdk.HostedFields.render({createOrder:function(){if(jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),!1===jQuery(e).is(".createOrder"))return o=angelleyeJsErrorLogger.generateErrorId(),angelleyeJsErrorLogger.addToLog(o,"Advanced CC Payment Started"),jQuery(e).addClass("createOrder"),angelleyeOrder.createOrder({errorLogId:o}).then(function(e){return e.orderID}).catch(e=>(angelleyeOrder.showError(e),""))},onCancel:function(e,r){r.redirect(angelleye_ppcp_manager.cancel_url)},onError:function(e){console.log(e)},styles:{input:{"font-size":angelleye_ppcp_manager.card_style_props.font_size,color:angelleye_ppcp_manager.card_style_props.color,"font-weight":angelleye_ppcp_manager.card_style_props.font_weight,"font-style":angelleye_ppcp_manager.card_style_props.font_style,padding:angelleye_ppcp_manager.card_style_props.padding}},fields:{number:{selector:"#angelleye_ppcp_cc-card-number",placeholder:"•••• •••• •••• ••••",addClass:"input-text wc-credit-card-form-card-number"},cvv:{selector:"#angelleye_ppcp_cc-card-cvc",placeholder:localizedMessages.cvc_placeholder},expirationDate:{selector:"#angelleye_ppcp_cc-card-expiry",placeholder:localizedMessages.expiry_date_placeholder}}}).then(function(t){t.on("cardTypeChange",function(r){if(r.cards.length>0){let o=r.cards[0].type.replace("master-card","mastercard").replace("american-express","amex").replace("diners-club","dinersclub").replace("-","");-1!==jQuery.inArray(o,angelleye_ppcp_manager.disable_cards)?(jQuery("#angelleye_ppcp_cc-card-number").addClass("ppcp-invalid-cart"),jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),angelleyeOrder.showError(localizedMessages.card_not_supported)):(jQuery("#angelleye_ppcp_cc-card-number").removeClass().addClass(o),jQuery("#angelleye_ppcp_cc-card-number").addClass("input-text wc-credit-card-form-card-number hosted-field-braintree braintree-hosted-fields-valid"));let t;"product"===angelleye_ppcp_manager.page?t="form.cart":"cart"===angelleye_ppcp_manager.page?t="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(t="yes"===angelleye_ppcp_manager.is_pay_page?"#order_review":e),jQuery("#angelleye_ppcp_cc_cc_payment_method_title").length>0&&jQuery("#angelleye_ppcp_cc_cc_payment_method_title").empty(),jQuery("<input>",{type:"hidden",id:"angelleye_ppcp_cc_payment_method_title",name:"angelleye_ppcp_cc_payment_method_title",value:angelleye_ppcp_manager.advanced_card_payments_title}).appendTo(t)}}),jQuery(document.body).off("submit_paypal_cc_form"),jQuery(document.body).on("submit_paypal_cc_form",a=>{console.log("submit_paypal_cc_form called"),a.preventDefault();let l=t.getState();if(void 0!==l.cards){if(l.fields.number.isValid){let n=l.cards[0].type;if((null!=n||0!==n.length)&&-1!==jQuery.inArray(n,angelleye_ppcp_manager.disable_cards)){jQuery(e).removeClass("processing paypal_cc_submiting HostedFields createOrder"),angelleyeOrder.hideProcessingSpinner(r),jQuery("#angelleye_ppcp_cc-card-number").addClass("ppcp-invalid-cart"),jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),angelleyeOrder.showError(localizedMessages.card_not_supported);return}}}else{jQuery(e).removeClass("processing paypal_cc_submiting HostedFields createOrder"),angelleyeOrder.hideProcessingSpinner(r),jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),angelleyeOrder.showError(localizedMessages.fields_not_valid);return}if(!1===Object.keys(l.fields).every(function(e){return l.fields[e].isValid})){jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),jQuery(e).removeClass("processing paypal_cc_submiting HostedFields createOrder"),angelleyeOrder.hideProcessingSpinner(r),angelleyeOrder.showError(localizedMessages.fields_not_valid);return}let c=[];c=[angelleye_ppcp_manager.three_d_secure_contingency];let d,s;"yes"===angelleye_ppcp_manager.is_pay_page?(d=angelleye_ppcp_manager.first_name,s=angelleye_ppcp_manager.last_name):(d=document.getElementById("billing_first_name")?document.getElementById("billing_first_name").value:"",s=document.getElementById("billing_last_name")?document.getElementById("billing_last_name").value:""),angelleyeOrder.hideProcessingSpinner(r),angelleyeOrder.showProcessingSpinner(r),t.submit({contingencies:c,cardholderName:d+" "+s}).then(function(r){r.orderId&&angelleyeOrder.checkoutFormCapture({checkoutSelector:e,payPalOrderId:r.orderId,errorLogId:o})},function(t){console.log("hf_submit_error_handler",t),jQuery(e).removeClass("processing paypal_cc_submiting HostedFields createOrder"),angelleyeOrder.hideProcessingSpinner(r);let a="";Array.isArray(t.details)&&t.details[0].description?a=t.details[0].description:t.message&&(a=t.message),Array.isArray(t.details)&&"INVALID_RESOURCE_ID"===t.details[0].issue&&(a=""),""!==a&&(angelleyeJsErrorLogger.logJsError(a,o),angelleyeOrder.showError(a))}).catch(e=>{angelleyeJsErrorLogger.logJsError(e,o),console.log("hf_submit_exception_handler",e)})})}).catch(function(e){angelleyeJsErrorLogger.logJsError(JSON.stringify(e),o),console.log("error: ",JSON.stringify(e))})},async applePayDataInit(){if(angelleyeOrder.isApplePayEnabled()){angelleyeOrder.showProcessingSpinner("#angelleye_ppcp_cart_apple_pay");let e=await angelleyeOrder.shippingAddressUpdate({});angelleyeOrder.hideProcessingSpinner("#angelleye_ppcp_cart_apple_pay"),void 0!==e.totalAmount?angelleye_ppcp_manager.angelleye_cart_totals=e:window.location.reload()}},getCartDetails:()=>angelleye_ppcp_manager.angelleye_cart_totals,updateCartTotalsInEnvironment(e){let r,o={renderNeeded:!0};if(e?r=e:jQuery("#angelleye_cart_totals").length&&(r=JSON.parse(jQuery("#angelleye_cart_totals").text())),r){let t=()=>{console.log("angelleye_cart_total_updated",r),angelleye_ppcp_manager.angelleye_cart_totals=r,jQuery(document.body).trigger("angelleye_cart_total_updated")},a=angelleyeOrder.getCartDetails();if(a.currencyCode!==r.currencyCode){console.log(`Currency changed, refreshing PayPal Lib SDK: ${a.currencyCode} => ${r.currencyCode}`);let l=angelleyeOrder.getCheckoutSelectorCss();angelleyeOrder.showProcessingSpinner(l),angelleye_ppcp_manager.paypal_sdk_url=pfwUrlHelper.setQueryParam("currency",r.currencyCode,angelleye_ppcp_manager.paypal_sdk_url),window.angelleyeLoadAsyncLibs(()=>{t(),angelleyeOrder.renderPaymentButtons(),angelleyeOrder.hideProcessingSpinner(l)},()=>{console.log("Unable to refresh the PayPal Lib"),angelleyeOrder.showError("<li>"+localizedMessages.currency_change_js_load_error+"</li>"),angelleyeOrder.hideProcessingSpinner(l)}),o.renderNeeded=!1}else t()}return o},addPaymentMethodAdvancedCreditCard(){if("undefined"==typeof angelleye_paypal_sdk)return;let e=angelleyeOrder.getCheckoutSelectorCss(),r=angelleye_paypal_sdk.CardFields({async createVaultSetupToken(){angelleyeOrder.showProcessingSpinner(e);let r=await fetch(angelleye_ppcp_manager.angelleye_ppcp_cc_setup_tokens,{method:"POST"}),{id:o}=await r.json();return o},async onApprove(r){let o=angelleyeOrder.getConstantValue("approval_token_id"),t=angelleye_ppcp_manager.advanced_credit_card_create_payment_token,a=`${t}&${o}=${r.vaultSetupToken}`;fetch(a,{method:"POST"}).then(e=>e.json()).then(e=>{window.location.href=e.redirect}).catch(r=>{angelleyeOrder.showError(r),angelleyeOrder.hideProcessingSpinner(e),console.error("An error occurred:",r)})},onError(r){angelleyeOrder.hideProcessingSpinner(e),angelleyeOrder.showError(r),console.error("Something went wrong:",r)}});r.isEligible()?(r.NameField().render("#ppcp-my-account-card-holder-name"),r.NumberField().render("#ppcp-my-account-card-number"),r.ExpiryField().render("#ppcp-my-account-expiration-date"),r.CVVField().render("#ppcp-my-account-cvv")):jQuery(".payment_method_angelleye_ppcp_cc").hide(),jQuery(e).unbind("submit").on("submit",o=>{angelleyeOrder.removeError(),(angelleyeOrder.isCCPaymentMethodSelected()||angelleyeOrder.isPpcpPaymentMethodSelected())&&(angelleyeOrder.showProcessingSpinner(e),!0===angelleyeOrder.isCCPaymentMethodSelected()&&(o.preventDefault(),r.submit().then(e=>{console.log("add_payment_method_submit_success")}).catch(r=>{angelleyeOrder.hideProcessingSpinner(e),angelleyeOrder.showError(r),console.error("add_payment_method_submit_error:",r)})))})},queuedEvents:{},addEventsForCallback(e,r,o){angelleyeOrder.queuedEvents[e]={event:r,data:o}},dequeueEvent(e){e in angelleyeOrder.queuedEvents&&delete angelleyeOrder.queuedEvents[e]},isPendingEventTriggering:!1,triggerPendingEvents(){for(let e in angelleyeOrder.isPendingEventTriggering=!0,angelleyeOrder.queuedEvents)angelleyeOrder.queuedEvents[e].data?jQuery(document.body).trigger(e,[angelleyeOrder.queuedEvents[e].data]):jQuery(document.body).trigger(e)},renderPaymentButtons(){angelleyeOrder.hideShowPlaceOrderButton(),angelleyeOrder.renderSmartButton(),!0===angelleyeOrder.isHostedFieldEligible()&&(0===jQuery("#angelleye_ppcp_cc-card-number iframe").length&&jQuery(angelleyeOrder.getCheckoutSelectorCss()).removeClass("HostedFields"),jQuery(".checkout_cc_separator").show(),jQuery("#wc-angelleye_ppcp-cc-form").show(),angelleyeOrder.renderHostedButtons())},hooks:{handleWooEvents(){jQuery(document.body).on("updated_cart_totals payment_method_selected updated_checkout",function(e,r){console.log(`hook_received => ${e.type}`,r,angelleyeOrder.getCartDetails()),angelleyeOrder.dequeueEvent(e.type);let o;void 0!==r&&void 0!==r.fragments&&void 0!==r.fragments.angelleye_payments_data?o=angelleyeOrder.updateCartTotalsInEnvironment(JSON.parse(r.fragments.angelleye_payments_data)):"updated_cart_totals"===e.type&&(o=angelleyeOrder.updateCartTotalsInEnvironment()),(!o||o.renderNeeded)&&angelleyeOrder.renderPaymentButtons()})},handleRaceConditionOnWooHooks(){jQuery(document.body).on("updated_cart_totals payment_method_selected updated_checkout",function(e,r){angelleyeOrder.isPendingEventTriggering||angelleyeOrder.addEventsForCallback(e.type,e,r)})},onPaymentCancellation(){jQuery(document.body).on("angelleye_paypal_oncancel",function(e){e.preventDefault(),angelleyeOrder.isProductPage()&&!1===angelleyeOrder.productAddToCart&&fetch(angelleye_ppcp_manager.update_cart_oncancel,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:jQuery(angelleyeOrder.getWooFormSelector()).serialize()}).then(function(e){return e.json()}).then(function(e){window.location.reload()})})}}};__=wp.i18n.__;const localizedMessages={card_not_supported:__("Unfortunately, we do not support this credit card type. Please try another card type.","paypal-for-woocommerce"),fields_not_valid:__("Unfortunately, your credit card details are not valid. Please review the card details and try again.","paypal-for-woocommerce"),error_message_checkout_validation:__("Unable to create the order due to the following errors.","paypal-for-woocommerce"),expiry_date_placeholder:__("MM / YY","paypal-for-woocommerce"),cvc_placeholder:__("CVC","paypal-for-woocommerce","paypal-for-woocommerce"),empty_cart_message:__("Your shopping cart seems to be empty.","paypal-for-woocommerce"),total_amount_placeholder:__("Total Amount","paypal-for-woocommerce"),apple_pay_pay_error:__("An error occurred while initiating the ApplePay payment.","paypal-for-woocommerce"),error_validating_merchant:__("This merchant is not enabled to process requested payment method. please contact website owner.","paypal-for-woocommerce"),general_error_message:__("We are unable to process your request at the moment, please contact website owner.","paypal-for-woocommerce"),shipping_amount_update_error:__("Unable to update the shipping amount.","paypal-for-woocommerce"),shipping_amount_pull_error:__("Unable to pull the shipping amount details based on selected address","paypal-for-woocommerce"),currency_change_js_load_error:__("We encountered an issue loading the updated currency. Please refresh the page or contact support for assistance.","paypal-for-woocommerce"),create_order_error:__("Unable to create the order, please contact the support.","paypal-for-woocommerce"),create_order_error_with_content:__("Unable to create the order, please contact the support with following error message.","paypal-for-woocommerce")},pfwUrlHelper={getUrlObject:e=>(e||(e=window.location.href),new URL(e)),setQueryParam(e,r,o){let t=(o=pfwUrlHelper.getUrlObject(o)).searchParams;return t.set(e,r),o.search=t.toString(),o.toString()},getQueryParams:e=>(e=pfwUrlHelper.getUrlObject(e)).searchParams,removeQueryParam(e,r){let o=(r=pfwUrlHelper.getUrlObject(r)).searchParams;return o.delete(e),r.search=o.toString(),r.toString()},removeAllParams:e=>((e=pfwUrlHelper.getUrlObject(e)).search="",e.toString())},angelleyeJsErrorLogger={errorStackMeta:{},generateErrorId:()=>Date.now()+Math.floor(101*Math.random()),addToLog(e,r){void 0===angelleyeJsErrorLogger.errorStackMeta[e]&&(angelleyeJsErrorLogger.errorStackMeta[e]=[]),angelleyeJsErrorLogger.errorStackMeta[e].push(r)},getLogTrace:e=>void 0!==angelleyeJsErrorLogger.errorStackMeta[e]?angelleyeJsErrorLogger.errorStackMeta[e]:[],logJsError(e,r){fetch(angelleye_ppcp_manager.handle_js_errors,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({error:e,logTrace:angelleyeJsErrorLogger.getLogTrace(r)})}).then(function(e){}).then(function(e){})}};
