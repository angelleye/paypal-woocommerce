function initSmartButtons(){console.log("initSmartButtons");let e=jQuery;if("undefined"==typeof angelleye_ppcp_manager)return!1;var o=".woocommerce";"checkout"===angelleye_ppcp_manager.page&&(o="yes"===angelleye_ppcp_manager.is_pay_page?"form#order_review":"form.checkout"),e(".variations_form").length&&e(".variations_form").on("show_variation",function(){e("#angelleye_ppcp_product").show()}).on("hide_variation",function(){e("#angelleye_ppcp_product").hide()});var c=function(){!0===p()&&e(".wcf-pre-checkout-offer-action").val(""),!1===i()&&e(".payment_method_angelleye_ppcp_cc").hide(),console.log(p(),angelleye_ppcp_manager.is_checkout_disable_smart_button),!0===p()&&"no"===angelleye_ppcp_manager.is_checkout_disable_smart_button?(showHidePlaceOrderBtn(),e("#angelleye_ppcp_checkout").show()):(e("#angelleye_ppcp_checkout").hide(),showHidePlaceOrderBtn())};e.angelleye_ppcp_scroll_to_notices=function(){var o=e(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");o.length||(o=e("form.checkout")),o.length||(o=e("form#order_review")),o.length&&e("html, body").animate({scrollTop:o.offset().top-100},1e3)};var r=function(c){e(o).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+c+"</div>"),e(o).removeClass("processing").unblock(),e(o).find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),e.angelleye_ppcp_scroll_to_notices()},t="checkout"===angelleye_ppcp_manager.page,a="product"===angelleye_ppcp_manager.page;angelleye_ppcp_manager.paymentaction;var n=function(){e.each(angelleye_ppcp_manager.button_selector,function(c,n){if(e(n).length&&!e(n).children().length&&"undefined"!=typeof angelleye_paypal_sdk){var l={layout:angelleye_ppcp_manager.style_layout,color:angelleye_ppcp_manager.style_color,shape:angelleye_ppcp_manager.style_shape,label:angelleye_ppcp_manager.style_label};""!==angelleye_ppcp_manager.style_height&&(l.height=parseInt(angelleye_ppcp_manager.style_height)),"vertical"!==angelleye_ppcp_manager.style_layout&&(l.tagline="yes"===angelleye_ppcp_manager.style_tagline),angelleye_paypal_sdk.Buttons({style:l,createOrder:function(o,c){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove();let l;if(t)l="#angelleye_ppcp_checkout_top"===n?"":e(n).closest("form").serialize();else if(a){var i=e("[name='add-to-cart']").val();e("<input>",{type:"hidden",name:"angelleye_ppcp-add-to-cart",value:i}).appendTo("form.cart"),l=e("form.cart").serialize()}else l=e("form.woocommerce-cart-form").serialize();return fetch(angelleye_ppcp_manager.create_order_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l}).then(function(e){return e.json()}).then(function(e){if(void 0===e.success)return e.orderID;var o=e.data.messages?e.data.messages:e.data;return"string"==typeof o?r('<div class="woocommerce-error">'+o+"</div>"):r('<ul class="woocommerce-error" role="alert">'+o.map(function(e){return"<li>"+e+"</li>"}).join("")+"</ul>"),null})},onApprove:function(o,c){e(".woocommerce").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t?e.post(angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+o.orderID+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout,function(e){window.location.href=e.data.redirect}):"yes"===angelleye_ppcp_manager.is_skip_final_review?c.redirect(angelleye_ppcp_manager.direct_capture+"&paypal_order_id="+o.orderID+"&paypal_payer_id="+o.payerID+"&from="+angelleye_ppcp_manager.page):c.redirect(angelleye_ppcp_manager.checkout_url+"&paypal_order_id="+o.orderID+"&paypal_payer_id="+o.payerID+"&from="+angelleye_ppcp_manager.page)},onCancel:function(o,c){e(".woocommerce").unblock(),e(document.body).trigger("angelleye_paypal_oncancel"),!1===t&&(window.location.href=window.location.href)},onClick:function(c,r){var t;"product"===angelleye_ppcp_manager.page?t="form.cart":"cart"===angelleye_ppcp_manager.page?t="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(t=o),e("#angelleye_ppcp_payment_method_title").length>0&&e("#angelleye_ppcp_payment_method_title").empty(),e("<input>",{type:"hidden",id:"angelleye_ppcp_payment_method_title",name:"angelleye_ppcp_payment_method_title",value:c.fundingSource}).appendTo(t)},onError:function(o){console.log(o),e(".woocommerce").unblock(),e(document.body).trigger("angelleye_paypal_onerror"),r('<div class="woocommerce-error">'+o+"</div>"),e.angelleye_ppcp_scroll_to_notices()}}).render(n)}})};e(document.body).hasClass("woocommerce-order-pay")&&e("#order_review").on("submit",function(c){return!0!==i()||(c.preventDefault(),!!e('input[name="wc-angelleye_ppcp_cc-payment-token"]').length&&"new"!==e('input[name="wc-angelleye_ppcp_cc-payment-token"]:checked').val()||(e(o).is(".paypal_cc_submiting")||(e(o).addClass("paypal_cc_submiting"),e(document.body).trigger("submit_paypal_cc_form")),!1))}),e(o).on("checkout_place_order_angelleye_ppcp_cc",function(c){return!0!==i()||(c.preventDefault(),!!e('input[name="wc-angelleye_ppcp_cc-payment-token"]').length&&"new"!==e('input[name="wc-angelleye_ppcp_cc-payment-token"]:checked').val()||(e(o).is(".paypal_cc_submiting")||(e(o).addClass("paypal_cc_submiting"),e(document.body).trigger("submit_paypal_cc_form")),!1))});var l=function(){if(e(o).is(".HostedFields"))return!1;"undefined"!=typeof angelleye_paypal_sdk&&(e(o).addClass("HostedFields"),angelleye_paypal_sdk.HostedFields.render({createOrder:function(){if(e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),!1===e(o).is(".createOrder")){var c;return e(o).addClass("createOrder"),t&&(c=e(o).serialize()),fetch(angelleye_ppcp_manager.create_order_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}).then(function(e){return e.json()}).then(function(e){if(void 0===e.success)return e.orderID;var o=e.data.messages?e.data.messages:e.data;return"string"==typeof o?r('<div class="woocommerce-error">'+o+"</div>"):r('<div class="woocommerce-error">'+o.map(function(e){return"<li>"+e+"</li>"}).join("")+"</div>"),""})}},onCancel:function(e,o){o.redirect(angelleye_ppcp_manager.cancel_url)},onError:function(e){console.log(e)},styles:{input:{"font-size":"1.3em"}},fields:{number:{selector:"#angelleye_ppcp_cc-card-number",placeholder:"•••• •••• •••• ••••",addClass:"input-text wc-credit-card-form-card-number"},cvv:{selector:"#angelleye_ppcp_cc-card-cvc",placeholder:"CVC"},expirationDate:{selector:"#angelleye_ppcp_cc-card-expiry",placeholder:"MM / YY"}}}).then(function(c){c.on("cardTypeChange",function(c){if(c.cards.length>0){var t,a=c.cards[0].type.replace("master-card","mastercard").replace("american-express","amex").replace("diners-club","dinersclub").replace("-","");-1!==jQuery.inArray(a,angelleye_ppcp_manager.disable_cards)?(e("#angelleye_ppcp_cc-card-number").addClass("ppcp-invalid-cart"),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),r('<div class="woocommerce-error">'+angelleye_ppcp_manager.card_not_supported+"</div>")):(e("#angelleye_ppcp_cc-card-number").removeClass().addClass(a),e("#angelleye_ppcp_cc-card-number").addClass("input-text wc-credit-card-form-card-number hosted-field-braintree braintree-hosted-fields-valid")),"product"===angelleye_ppcp_manager.page?t="form.cart":"cart"===angelleye_ppcp_manager.page?t="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(t="yes"===angelleye_ppcp_manager.is_pay_page?"#order_review":o),e("#angelleye_ppcp_cc_cc_payment_method_title").length>0&&e("#angelleye_ppcp_cc_cc_payment_method_title").empty(),e("<input>",{type:"hidden",id:"angelleye_ppcp_cc_payment_method_title",name:"angelleye_ppcp_cc_payment_method_title",value:angelleye_ppcp_manager.advanced_card_payments_title}).appendTo(t)}}),e(document.body).on("submit_paypal_cc_form",function(t){t.preventDefault();var a,n,l=c.getState();if(void 0!==l.cards){if(l.fields.number.isValid){var i=l.cards[0].type;if((null!=i||0!==i.length)&&-1!==jQuery.inArray(i,angelleye_ppcp_manager.disable_cards)){e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),e("#angelleye_ppcp_cc-card-number").addClass("ppcp-invalid-cart"),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),r('<div class="woocommerce-error">'+angelleye_ppcp_manager.card_not_supported+"</div>");return}}}else{e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),r('<div class="woocommerce-error">'+angelleye_ppcp_manager.fields_not_valid+"</div>");return}if(!1===Object.keys(l.fields).every(function(e){return l.fields[e].isValid})){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),r('<div class="woocommerce-error">'+angelleye_ppcp_manager.fields_not_valid+"</div>");return}var p=[];p=[angelleye_ppcp_manager.three_d_secure_contingency],e(o).addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.angelleye_ppcp_scroll_to_notices(),"yes"===angelleye_ppcp_manager.is_pay_page?(a=angelleye_ppcp_manager.first_name,n=angelleye_ppcp_manager.last_name):(a=document.getElementById("billing_first_name")?document.getElementById("billing_first_name").value:"",n=document.getElementById("billing_last_name")?document.getElementById("billing_last_name").value:""),c.submit({contingencies:p,cardholderName:a+" "+n}).then(function(o){o.orderId&&e.post(angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+o.orderId+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout+"&is_pay_page="+angelleye_ppcp_manager.is_pay_page,function(e){window.location.href=e.data.redirect})},function(c){e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock();var t="";Array.isArray(c.details)&&c.details[0].description?t=c.details[0].description:c.message&&(t=c.message),Array.isArray(c.details)&&"INVALID_RESOURCE_ID"===c.details[0].issue&&(t=""),""!==t&&r('<div class="woocommerce-error">'+t+"</div>")})})}).catch(function(e){console.log("error: ",JSON.stringify(e))}))};function i(){return!!t&&"yes"===angelleye_ppcp_manager.advanced_card_payments&&"undefined"!=typeof angelleye_paypal_sdk&&!0===angelleye_paypal_sdk.HostedFields.isEligible()}function p(){return e("#payment_method_angelleye_ppcp").is(":checked")}!1===t&&n(),"yes"===angelleye_ppcp_manager.is_pay_page&&(c(),setTimeout(function(){n(),!0===i()&&(0===e("#angelleye_ppcp_cc-card-number iframe").length&&e(o).removeClass("HostedFields"),e(".checkout_cc_separator").show(),e("#wc-angelleye_ppcp-cc-form").show(),l())},300)),e(document.body).on("updated_cart_totals updated_checkout payment_method_selected",function(){c(),setTimeout(function(){n(),!0===i()&&(0===e("#angelleye_ppcp_cc-card-number iframe").length&&e(o).removeClass("HostedFields"),e(".checkout_cc_separator").show(),e("#wc-angelleye_ppcp-cc-form").show(),l())},300)}),e(document.body).on("removed_coupon_in_checkout",function(){window.location.href=window.location.href})}jQuery,angelleyeLoadPayPalScript({url:angelleye_ppcp_manager.paypal_sdk_url,script_attributes:{"data-namespace":"angelleye_paypal_sdk"}},initSmartButtons);