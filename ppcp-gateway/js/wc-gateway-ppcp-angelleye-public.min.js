!function(e){"use strict";e(function(){if("undefined"==typeof angelleye_ppcp_manager)return!1;var r="";"checkout"===angelleye_ppcp_manager.page&&(r="yes"===angelleye_ppcp_manager.is_pay_page?"form#order_review":"form.checkout"),e(".variations_form").length&&e(".variations_form").on("show_variation",function(){e("#angelleye_ppcp_product").show()}).on("hide_variation",function(){e("#angelleye_ppcp_product").hide()});var o=function(){!0===s()&&e(".wcf-pre-checkout-offer-action").val(""),!1===l()&&e(".payment_method_angelleye_ppcp_cc").hide(),"yes"===angelleye_ppcp_manager.advanced_card_payments?"no"===angelleye_ppcp_manager.enable_separate_payment_method?!0===l()?e("#place_order").show():!0===s()&&"yes"===angelleye_ppcp_manager.is_checkout_disable_smart_button?e("#place_order").show():e("#place_order").hide():"yes"===angelleye_ppcp_manager.enable_separate_payment_method&&(!0===s()&&"no"===angelleye_ppcp_manager.is_checkout_disable_smart_button?e("#place_order").hide():e("#place_order").show()):!0===s()&&"no"===angelleye_ppcp_manager.is_checkout_disable_smart_button?e("#place_order").hide():e("#place_order").show()};e.angelleye_ppcp_scroll_to_notices=function(){var r=e(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");r.length||(r=e("form.checkout")),r.length||(r=e("form#order_review")),r.length&&e("html, body").animate({scrollTop:r.offset().top-100},1e3)};var c=function(o){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e(r).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+o+"</div>"),e(r).removeClass("processing").unblock(),e(r).find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),e.angelleye_ppcp_scroll_to_notices()},a="checkout"===angelleye_ppcp_manager.page,t="product"===angelleye_ppcp_manager.page;angelleye_ppcp_manager.paymentaction;var n=function(){e.each(angelleye_ppcp_manager.button_selector,function(o,n){if(e(n).length&&!e(n).children().length&&"undefined"!=typeof angelleye_paypal_sdk){var i={layout:angelleye_ppcp_manager.style_layout,color:angelleye_ppcp_manager.style_color,shape:angelleye_ppcp_manager.style_shape,label:angelleye_ppcp_manager.style_label};""!==angelleye_ppcp_manager.style_height&&(i.height=parseInt(angelleye_ppcp_manager.style_height)),"vertical"!==angelleye_ppcp_manager.style_layout&&(i.tagline="yes"===angelleye_ppcp_manager.style_tagline),angelleye_paypal_sdk.Buttons({style:i,createOrder:function(r,o){var r;if(a)r=e(n).closest("form").serialize();else if(t){var i=e("[name='add-to-cart']").val();e("<input>",{type:"hidden",name:"angelleye_ppcp-add-to-cart",value:i}).appendTo("form.cart"),r=e("form.cart").serialize()}else r=e("form.woocommerce-cart-form").serialize();return fetch(angelleye_ppcp_manager.create_order_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}).then(function(e){return e.json()}).then(function(e){if(void 0===e.success)return e.orderID;var r=e.data.messages?e.data.messages:e.data;return"string"==typeof r?c('<div class="woocommerce-error">'+r+"</div>"):c('<ul class="woocommerce-error" role="alert">'+r.map(function(e){return"<li>"+e+"</li>"}).join("")+"</ul>"),null})},onApprove:function(r,o){e(".woocommerce").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a?e.post(angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+r.orderID+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout,function(e){window.location.href=e.data.redirect}):"yes"===angelleye_ppcp_manager.is_skip_final_review?o.redirect(angelleye_ppcp_manager.direct_capture+"&paypal_order_id="+r.orderID+"&paypal_payer_id="+r.payerID+"&from="+angelleye_ppcp_manager.page):o.redirect(angelleye_ppcp_manager.checkout_url+"&paypal_order_id="+r.orderID+"&paypal_payer_id="+r.payerID+"&from="+angelleye_ppcp_manager.page)},onCancel:function(r,o){e(".woocommerce").unblock(),e(document.body).trigger("angelleye_paypal_oncancel"),!1===a&&(window.location.href=window.location.href)},onClick:function(o,c){var a;"product"===angelleye_ppcp_manager.page?a="form.cart":"cart"===angelleye_ppcp_manager.page?a="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(a=r),e("#angelleye_ppcp_payment_method_title").length>0&&e("#angelleye_ppcp_payment_method_title").empty(),e("<input>",{type:"hidden",id:"angelleye_ppcp_payment_method_title",name:"angelleye_ppcp_payment_method_title",value:o.fundingSource}).appendTo(a)},onError:function(r){console.log(r),e(".woocommerce").unblock(),e(document.body).trigger("angelleye_paypal_onerror"),e.angelleye_ppcp_scroll_to_notices(),!1===a&&(window.location.href=window.location.href)}}).render(n)}})};e(document.body).hasClass("woocommerce-order-pay")&&e("#order_review").on("submit",function(o){return!0!==l()||(o.preventDefault(),e(r).is(".paypal_cc_submiting")||(e(r).addClass("paypal_cc_submiting"),e(document.body).trigger("submit_paypal_cc_form")),!1)}),e(r).on("checkout_place_order_"+angelleye_ppcp_manager.prefix_cc_field,function(o){return!0!==l()||(o.preventDefault(),e(r).is(".paypal_cc_submiting")||(e(r).addClass("paypal_cc_submiting"),e(document.body).trigger("submit_paypal_cc_form")),!1)});var i=function(){if(e(r).is(".HostedFields"))return!1;"undefined"!=typeof angelleye_paypal_sdk&&(e(r).addClass("HostedFields"),angelleye_paypal_sdk.HostedFields.render({createOrder:function(){if(!1===e(r).is(".createOrder")){var o;return e(r).addClass("createOrder"),a&&(o=e(r).serialize()),fetch(angelleye_ppcp_manager.create_order_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(function(e){return e.json()}).then(function(e){if(void 0===e.success)return e.orderID;var r=e.data.messages?e.data.messages:e.data;return"string"==typeof r?c('<div class="woocommerce-error">'+r+"</div>"):c('<div class="woocommerce-error">'+r.map(function(e){return"<li>"+e+"</li>"}).join("")+"</div>"),null})}},onCancel:function(e,r){r.redirect(angelleye_ppcp_manager.cancel_url)},onError:function(e){},styles:{input:{"font-size":"1.3em"}},fields:{number:{selector:"#angelleye_ppcp-card-number",placeholder:"•••• •••• •••• ••••",addClass:"input-text wc-credit-card-form-card-number"},cvv:{selector:"#angelleye_ppcp-card-cvc",placeholder:"CVC"},expirationDate:{selector:"#angelleye_ppcp-card-expiry",placeholder:"MM / YY"}}}).then(function(o){o.on("cardTypeChange",function(o){if(o.cards.length>0){var a,t=o.cards[0].type.replace("master-card","mastercard").replace("american-express","amex").replace("diners-club","dinersclub").replace("-","");-1!==jQuery.inArray(t,angelleye_ppcp_manager.disable_cards)?(e("#angelleye_ppcp-card-number").addClass("ppcp-invalid-cart"),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.card_not_supported+"</div>")):(e("#angelleye_ppcp-card-number").removeClass().addClass(t),e("#angelleye_ppcp-card-number").addClass("input-text wc-credit-card-form-card-number hosted-field-braintree braintree-hosted-fields-valid")),"product"===angelleye_ppcp_manager.page?a="form.cart":"cart"===angelleye_ppcp_manager.page?a="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(a="yes"===angelleye_ppcp_manager.is_pay_page?"#order_review":r),e("#angelleye_ppcp_payment_method_title").length>0&&e("#angelleye_ppcp_payment_method_title").empty(),e("<input>",{type:"hidden",id:"angelleye_ppcp_payment_method_title",name:"angelleye_ppcp_payment_method_title",value:"Advanced Credit Cards"}).appendTo(a)}}),e(document.body).on("submit_paypal_cc_form",function(a){a.preventDefault();var t,n,i=o.getState();if(void 0!==i.cards){if(i.fields.number.isValid){var l=i.cards[0].type;if((null!=l||0!==l.length)&&-1!==jQuery.inArray(l,angelleye_ppcp_manager.disable_cards)){e(r).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),e("#angelleye_ppcp-card-number").addClass("ppcp-invalid-cart"),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.card_not_supported+"</div>");return}}}else{e(r).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.fields_not_valid+"</div>");return}if(!1===Object.keys(i.fields).every(function(e){return i.fields[e].isValid})){e(r).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.fields_not_valid+"</div>");return}var s=[];if(s=[angelleye_ppcp_manager.three_d_secure_contingency],e(r).addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.angelleye_ppcp_scroll_to_notices(),"yes"===angelleye_ppcp_manager.is_pay_page?(t=angelleye_ppcp_manager.first_name,n=angelleye_ppcp_manager.last_name):(t=document.getElementById("billing_first_name")?document.getElementById("billing_first_name").value:"",n=document.getElementById("billing_last_name")?document.getElementById("billing_last_name").value:""),!t||!n){c('<div class="woocommerce-error">'+angelleye_ppcp_manager.cardholder_name_required+"</div>"),e(r).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock();return}o.submit({contingencies:s,cardholderName:t+" "+n}).then(function(r){r.orderId&&e.post(angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+r.orderId+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout+"&is_pay_page="+angelleye_ppcp_manager.is_pay_page,function(e){window.location.href=e.data.redirect})},function(o){console.log(o),e(r).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock();var a="";a=o.details[0].description?o.details[0].description:o.message,"INVALID_RESOURCE_ID"===o.details[0].issue&&(a=""),""!==a&&c('<div class="woocommerce-error">'+a+"</div>")})})}).catch(function(e){console.log("error: ",JSON.stringify(e))}))};function l(){if(a&&"yes"===angelleye_ppcp_manager.advanced_card_payments){if("undefined"==typeof angelleye_paypal_sdk)return!1;if(!0==angelleye_paypal_sdk.HostedFields.isEligible())return!0}return!1}function s(){return!!e("#payment_method_angelleye_ppcp").is(":checked")}!1===a&&n(),"yes"===angelleye_ppcp_manager.is_pay_page&&(o(),setTimeout(function(){n(),!0===l()&&(0===e("#angelleye_ppcp-card-number iframe").length&&e(r).removeClass("HostedFields"),e(".checkout_cc_separator").show(),e("#wc-angelleye_ppcp-cc-form").show(),i())},300)),e(document.body).on("updated_cart_totals updated_checkout",function(){o(),setTimeout(function(){n(),!0===l()&&(0===e("#angelleye_ppcp-card-number iframe").length&&e(r).removeClass("HostedFields"),e(".checkout_cc_separator").show(),e("#wc-angelleye_ppcp-cc-form").show(),i())},300)}),e(r).on("click",'input[name="payment_method"]',function(){o()})})}(jQuery);