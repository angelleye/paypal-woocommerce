function initSmartButtons(){console.log("initSmartButtons");let e=jQuery;if("undefined"==typeof angelleye_ppcp_manager)return!1;var o=".woocommerce";"checkout"===angelleye_ppcp_manager.page&&(o="yes"===angelleye_ppcp_manager.is_pay_page?"form#order_review":"form.checkout"),e(".variations_form").length&&e(".variations_form").on("show_variation",function(){e("#angelleye_ppcp_product").show()}).on("hide_variation",function(){e("#angelleye_ppcp_product").hide()});var r=function(){!0===p()&&e(".wcf-pre-checkout-offer-action").val(""),!1===l()&&e(".payment_method_angelleye_ppcp_cc").hide(),!0===p()&&"no"===angelleye_ppcp_manager.is_checkout_disable_smart_button?(showHidePlaceOrderBtn(),e("#angelleye_ppcp_checkout").show()):(e("#angelleye_ppcp_checkout").hide(),showHidePlaceOrderBtn())};e.angelleye_ppcp_scroll_to_notices=function(){var o=e(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");o.length||(o=e("form.checkout")),o.length||(o=e("form#order_review")),o.length&&e("html, body").animate({scrollTop:o.offset().top-100},1e3)};var c=function(r){e(o).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+r+"</div>"),e(o).removeClass("processing").unblock(),e(o).find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),e.angelleye_ppcp_scroll_to_notices()},t="checkout"===angelleye_ppcp_manager.page,a="product"===angelleye_ppcp_manager.page;angelleye_ppcp_manager.paymentaction;var n=function(){e.each(angelleye_ppcp_manager.button_selector,function(r,n){if(e(n).length&&!e(n).children().length&&"undefined"!=typeof angelleye_paypal_sdk){var i={layout:angelleye_ppcp_manager.style_layout,color:angelleye_ppcp_manager.style_color,shape:angelleye_ppcp_manager.style_shape,label:angelleye_ppcp_manager.style_label};""!==angelleye_ppcp_manager.style_height&&(i.height=parseInt(angelleye_ppcp_manager.style_height)),"vertical"!==angelleye_ppcp_manager.style_layout&&(i.tagline="yes"===angelleye_ppcp_manager.style_tagline),angelleye_paypal_sdk.Buttons({style:i,createOrder:function(o,r){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove();let i;if(t)i="#angelleye_ppcp_checkout_top"===n?"":e(n).closest("form").serialize();else if(a){var l=e("[name='add-to-cart']").val();e("<input>",{type:"hidden",name:"angelleye_ppcp-add-to-cart",value:l}).appendTo("form.cart"),i=e("form.cart").serialize()}else i=e("form.woocommerce-cart-form").serialize();return fetch(angelleye_ppcp_manager.create_order_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}).then(function(e){return e.json()}).then(function(e){if(void 0===e.success)return e.orderID;var o=e.data.messages?e.data.messages:e.data;return"string"==typeof o?c('<div class="woocommerce-error">'+o+"</div>"):c('<ul class="woocommerce-error" role="alert">'+o.map(function(e){return"<li>"+e+"</li>"}).join("")+"</ul>"),null})},onApprove:function(o,r){e(".woocommerce").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t?e.post(angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+o.orderID+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout,function(e){window.location.href=e.data.redirect}):"yes"===angelleye_ppcp_manager.is_skip_final_review?r.redirect(angelleye_ppcp_manager.direct_capture+"&paypal_order_id="+o.orderID+"&paypal_payer_id="+o.payerID+"&from="+angelleye_ppcp_manager.page):r.redirect(angelleye_ppcp_manager.checkout_url+"&paypal_order_id="+o.orderID+"&paypal_payer_id="+o.payerID+"&from="+angelleye_ppcp_manager.page)},onCancel:function(o,r){e(".woocommerce").unblock(),e(document.body).trigger("angelleye_paypal_oncancel"),!1===t&&(window.location.href=window.location.href)},onClick:function(r,c){var t;"product"===angelleye_ppcp_manager.page?t="form.cart":"cart"===angelleye_ppcp_manager.page?t="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(t=o),e("#angelleye_ppcp_payment_method_title").length>0&&e("#angelleye_ppcp_payment_method_title").empty(),e("<input>",{type:"hidden",id:"angelleye_ppcp_payment_method_title",name:"angelleye_ppcp_payment_method_title",value:r.fundingSource}).appendTo(t)},onError:function(o){console.log(o),e(".woocommerce").unblock(),e(document.body).trigger("angelleye_paypal_onerror"),e.angelleye_ppcp_scroll_to_notices(),!1===t&&(window.location.href=window.location.href)}}).render(n)}})};e(document.body).hasClass("woocommerce-order-pay")&&e("#order_review").on("submit",function(r){return!0!==l()||(r.preventDefault(),!!e('input[name="wc-angelleye_ppcp_cc-payment-token"]').length&&"new"!==e('input[name="wc-angelleye_ppcp_cc-payment-token"]:checked').val()||(e(o).is(".paypal_cc_submiting")||(e(o).addClass("paypal_cc_submiting"),e(document.body).trigger("submit_paypal_cc_form")),!1))}),e(o).on("checkout_place_order_angelleye_ppcp_cc",function(r){return!0!==l()||(r.preventDefault(),!!e('input[name="wc-angelleye_ppcp_cc-payment-token"]').length&&"new"!==e('input[name="wc-angelleye_ppcp_cc-payment-token"]:checked').val()||(e(o).is(".paypal_cc_submiting")||(e(o).addClass("paypal_cc_submiting"),e(document.body).trigger("submit_paypal_cc_form")),!1))});var i=function(){if(e(o).is(".HostedFields"))return!1;"undefined"!=typeof angelleye_paypal_sdk&&(e(o).addClass("HostedFields"),angelleye_paypal_sdk.HostedFields.render({createOrder:function(){if(e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),!1===e(o).is(".createOrder")){var r;return e(o).addClass("createOrder"),t&&(r=e(o).serialize()),fetch(angelleye_ppcp_manager.create_order_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}).then(function(e){return e.json()}).then(function(e){if(void 0===e.success)return e.orderID;var o=e.data.messages?e.data.messages:e.data;return"string"==typeof o?c('<div class="woocommerce-error">'+o+"</div>"):c('<div class="woocommerce-error">'+o.map(function(e){return"<li>"+e+"</li>"}).join("")+"</div>"),""})}},onCancel:function(e,o){o.redirect(angelleye_ppcp_manager.cancel_url)},onError:function(e){console.log(e)},styles:{input:{"font-size":"1.3em"}},fields:{number:{selector:"#angelleye_ppcp_cc-card-number",placeholder:"•••• •••• •••• ••••",addClass:"input-text wc-credit-card-form-card-number"},cvv:{selector:"#angelleye_ppcp_cc-card-cvc",placeholder:"CVC"},expirationDate:{selector:"#angelleye_ppcp_cc-card-expiry",placeholder:"MM / YY"}}}).then(function(r){r.on("cardTypeChange",function(r){if(r.cards.length>0){var t,a=r.cards[0].type.replace("master-card","mastercard").replace("american-express","amex").replace("diners-club","dinersclub").replace("-","");-1!==jQuery.inArray(a,angelleye_ppcp_manager.disable_cards)?(e("#angelleye_ppcp_cc-card-number").addClass("ppcp-invalid-cart"),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.card_not_supported+"</div>")):(e("#angelleye_ppcp_cc-card-number").removeClass().addClass(a),e("#angelleye_ppcp_cc-card-number").addClass("input-text wc-credit-card-form-card-number hosted-field-braintree braintree-hosted-fields-valid")),"product"===angelleye_ppcp_manager.page?t="form.cart":"cart"===angelleye_ppcp_manager.page?t="form.woocommerce-cart-form":"checkout"===angelleye_ppcp_manager.page&&(t="yes"===angelleye_ppcp_manager.is_pay_page?"#order_review":o),e("#angelleye_ppcp_cc_cc_payment_method_title").length>0&&e("#angelleye_ppcp_cc_cc_payment_method_title").empty(),e("<input>",{type:"hidden",id:"angelleye_ppcp_cc_payment_method_title",name:"angelleye_ppcp_cc_payment_method_title",value:angelleye_ppcp_manager.advanced_card_payments_title}).appendTo(t)}}),e(document.body).on("submit_paypal_cc_form",function(t){t.preventDefault();var a,n,i=r.getState();if(void 0!==i.cards){if(i.fields.number.isValid){var l=i.cards[0].type;if((null!=l||0!==l.length)&&-1!==jQuery.inArray(l,angelleye_ppcp_manager.disable_cards)){e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),e("#angelleye_ppcp_cc-card-number").addClass("ppcp-invalid-cart"),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.card_not_supported+"</div>");return}}}else{e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.fields_not_valid+"</div>");return}if(!1===Object.keys(i.fields).every(function(e){return i.fields[e].isValid})){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock(),c('<div class="woocommerce-error">'+angelleye_ppcp_manager.fields_not_valid+"</div>");return}var p=[];p=[angelleye_ppcp_manager.three_d_secure_contingency],e(o).addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.angelleye_ppcp_scroll_to_notices(),"yes"===angelleye_ppcp_manager.is_pay_page?(a=angelleye_ppcp_manager.first_name,n=angelleye_ppcp_manager.last_name):(a=document.getElementById("billing_first_name")?document.getElementById("billing_first_name").value:"",n=document.getElementById("billing_last_name")?document.getElementById("billing_last_name").value:""),r.submit({contingencies:p,cardholderName:a+" "+n}).then(function(o){o.orderId&&e.post(angelleye_ppcp_manager.cc_capture+"&paypal_order_id="+o.orderId+"&woocommerce-process-checkout-nonce="+angelleye_ppcp_manager.woocommerce_process_checkout+"&is_pay_page="+angelleye_ppcp_manager.is_pay_page,function(e){window.location.href=e.data.redirect})},function(r){e(o).removeClass("processing paypal_cc_submiting HostedFields createOrder").unblock();var t="";Array.isArray(r.details)&&r.details[0].description?t=r.details[0].description:r.message&&(t=r.message),Array.isArray(r.details)&&"INVALID_RESOURCE_ID"===r.details[0].issue&&(t=""),""!==t&&c('<div class="woocommerce-error">'+t+"</div>")})})}).catch(function(e){console.log("error: ",JSON.stringify(e))}))};function l(){return!!t&&"yes"===angelleye_ppcp_manager.advanced_card_payments&&"undefined"!=typeof angelleye_paypal_sdk&&!0===angelleye_paypal_sdk.HostedFields.isEligible()}function p(){return e("#payment_method_angelleye_ppcp").is(":checked")}!1===t&&n(),"yes"===angelleye_ppcp_manager.is_pay_page&&(r(),setTimeout(function(){n(),!0===l()&&(0===e("#angelleye_ppcp_cc-card-number iframe").length&&e(o).removeClass("HostedFields"),e(".checkout_cc_separator").show(),e("#wc-angelleye_ppcp-cc-form").show(),i())},300)),e(document.body).on("updated_cart_totals updated_checkout payment_method_selected",function(c){eventQueue.dequeueEvent(c.type),r(),setTimeout(function(){n(),!0===l()&&(0===e("#angelleye_ppcp_cc-card-number iframe").length&&e(o).removeClass("HostedFields"),e(".checkout_cc_separator").show(),e("#wc-angelleye_ppcp-cc-form").show(),i())},300)}),e(document.body).on("removed_coupon_in_checkout",function(){window.location.href=window.location.href}),eventQueue.triggerPendingEvents()}let queuedEvents={};const eventQueue={dequeueEvent(e){e in queuedEvents&&delete queuedEvents[e]},isPendingEventTriggering:!1,triggerPendingEvents(){for(let e in eventQueue.isPendingEventTriggering=!0,console.log("triggering pending events",queuedEvents),queuedEvents)queuedEvents[e].data?jQuery(document.body).trigger(e,[queuedEvents[e].data]):jQuery(document.body).trigger(e)},addEventsForCallback(e,o,r){queuedEvents[e]={event:o,data:r}},handleRaceConditionOnWooHooks(){jQuery(document.body).on("updated_cart_totals payment_method_selected updated_checkout",function(e,o){eventQueue.isPendingEventTriggering||eventQueue.addEventsForCallback(e.type,e,o)})}};jQuery,eventQueue.handleRaceConditionOnWooHooks(),angelleyeLoadPayPalScript({url:angelleye_ppcp_manager.paypal_sdk_url,script_attributes:angelleye_ppcp_manager.paypal_sdk_attributes},initSmartButtons);
